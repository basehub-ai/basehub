import { GraphQLSchema } from "graphql";
import { RenderContext } from "../common/RenderContext.js";

export const renderModuleAugmentation = (
  _schema: GraphQLSchema,
  ctx: RenderContext
) => {
  ctx.addCodeBlock(
    `/*=============================================================================
 * This file was automatically generated by the BaseHub SDK and contains type
 * definitions based on your repository schema. Credits to https://genql.dev/
 * for the type generation.
 *
 * You can safely commit this to version control.
 *============================================================================*/

declare module "${ctx.config?.packageName || "basehub"}" {
  export interface Query extends _Query {}
  export interface QueryGenqlSelection extends _QueryGenqlSelection {}
  export interface Mutation extends _Mutation {}
  export interface MutationGenqlSelection extends _MutationGenqlSelection {}
  export interface FragmentsMap extends _FragmentsMap {}
  export interface Scalars extends _Scalars {}
}

import type { Transaction } from 'basehub/api-transaction'

interface _Query extends Query {}
interface _QueryGenqlSelection extends QueryGenqlSelection {}
interface _Mutation extends Mutation {}
interface _MutationGenqlSelection extends MutationGenqlSelection {}
interface _FragmentsMap extends FragmentsMap {}
interface _Scalars extends Scalars {}`
  );
};

export const enhanceMutationGenqlSelection = (schemaFileContents: string) => {
  // edit `MutationGenqlSelection` to receive the Transaction directly instead of a string
  return schemaFileContents
    .replace(
      `    /** Transaction data. */
    data: Scalars['String']`,
      `    /** Transaction data. */
    data: Transaction | Scalars['String']`
    )
    .replace(
      `    /** Transaction data. */
    data: Scalars["String"]`,
      `    /** Transaction data. */
    data: Transaction | Scalars["String"]`
    );
};
